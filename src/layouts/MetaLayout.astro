---
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import MetaTags from '../components/MetaTags.astro';
import '../styles/global.css';

type Frontmatter = {
  title: string;
  description?: string;
  canonical?: string;
};

const { frontmatter, headings } = Astro.props as {
  frontmatter: Frontmatter;
  headings?: Array<{ depth: number; slug: string; text: string }>;
};

const ensureTrailingSlash = (value?: string | null) => {
  if (!value) return undefined;
  return value.endsWith('/') ? value : `${value}/`;
};

const pageTitle = frontmatter.title ?? 'Mythoskolis';
const metaDescription =
  frontmatter.description ??
  "Documentation interne de Mythoskolis : structure Ã©ditoriale, navigation et intentions pour les IA.";
const canonical = ensureTrailingSlash(frontmatter.canonical ?? Astro.url?.pathname);
const toc = (headings ?? []).filter((h) => h.depth === 2 || h.depth === 3);
---

<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="index, follow" />
    <MetaTags
      title={`${pageTitle} | Mythoskolis`}
      description={metaDescription}
      canonical={canonical}
      type="article"
    />
  </head>

  <body class="min-h-screen flex flex-col bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-100">
    <Header />

    <main class="flex-1 max-w-4xl mx-auto px-4 py-12 space-y-8">
      <header class="space-y-3">
        <p class="mk-kicker text-indigo-600 dark:text-indigo-300">Documentation meta</p>
        <h1 class="text-4xl font-bold text-slate-900 dark:text-slate-50">{pageTitle}</h1>
        {frontmatter.description ? (
          <p class="text-lg text-slate-700 dark:text-slate-200">{frontmatter.description}</p>
        ) : null}
      </header>

      {toc.length ? (
        <nav class="mk-card-ghost border border-dashed border-slate-200/80 p-4 text-sm dark:border-slate-700/80">
          <p class="mb-2 text-base font-semibold text-slate-900 dark:text-slate-50">Sommaire</p>
          <ul class="space-y-2">
            {toc.map((h) => (
              <li class={h.depth === 3 ? 'pl-4 text-slate-600 dark:text-slate-300' : ''}>
                <a
                  class="text-indigo-700 hover:text-indigo-900 dark:text-indigo-300 dark:hover:text-indigo-100"
                  href={`#${h.slug}`}
                >
                  {h.text}
                </a>
              </li>
            ))}
          </ul>
        </nav>
      ) : null}

      <article class="mk-prose-card mk-card p-6 md:p-8">
        <slot />
      </article>
    </main>

    <Footer />
  </body>
</html>
