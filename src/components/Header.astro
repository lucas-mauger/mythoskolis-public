<script is:inline>
  (function () {
    const THEME_KEY = "mythos-theme";
    const saved = (localStorage.getItem(THEME_KEY) || "").toLowerCase().trim();
    const savedMode = saved === "dark" || saved === "light" || saved === "auto" ? saved : "auto";
    const prefersDark = window.matchMedia?.("(prefers-color-scheme: dark)")?.matches ?? false;
    const initialTheme = savedMode === "auto" ? (prefersDark ? "dark" : "light") : savedMode;
    const isDark = initialTheme === "dark";
    const root = document.documentElement;
    const body = document.body;
    const reset = (el) => {
      el.classList.remove("dark", "theme-dark");
    };
    reset(root);
    reset(body);
    root.setAttribute("data-theme-mode", savedMode);
    body.setAttribute("data-theme-mode", savedMode);
    if (isDark) {
      root.classList.add("theme-dark", "dark");
      body.classList.add("theme-dark", "dark");
      root.setAttribute("data-theme", "dark");
      body.setAttribute("data-theme", "dark");
    } else {
      root.setAttribute("data-theme", "light");
      body.setAttribute("data-theme", "light");
    }
  })();
</script>

<header class="relative z-50 pl-3 pr-1 pt-3 pb-3 w-full border-b border-slate-200 bg-white/80 backdrop-blur dark:border-slate-700/70 dark:bg-slate-900/80">
  <nav class="max-w-5xl mx-auto flex items-center justify-between pl-3 pr-2 sm:pl-4 sm:pr-3">
    <a href="/" class="text-xl font-bold tracking-tight text-slate-900 hover:text-black dark:text-white dark:hover:text-slate-100">
      Mythoskolis
    </a>

    <div class="flex items-center gap-4 text-slate-700 dark:text-slate-200">
      <button
        class="md:hidden inline-flex items-center justify-center rounded-full border border-slate-200 bg-white px-3 py-1.5 text-sm font-semibold text-slate-800 shadow-sm transition hover:border-slate-300 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100 dark:hover:border-slate-500 order-2 md:order-1"
        type="button"
        aria-label="Ouvrir le menu"
        data-menu-toggle
      >
        ‚ò∞
      </button>
      <ul class="hidden md:flex items-center gap-6 text-slate-700 dark:text-slate-200 order-1 md:order-1" data-desktop-links>
        <li>
          <a class="text-slate-700 hover:text-black dark:text-slate-200 dark:hover:text-white inline-flex items-center gap-2" href="/entites/">
            <img src="/icons/entites_clear.webp" alt="" class="menu-icon h-4 w-4 object-contain shrink-0 dark:invert dark:brightness-90" loading="lazy" />
            Entit√©s
          </a>
        </li>
        <li>
          <a class="text-slate-700 hover:text-black dark:text-slate-200 dark:hover:text-white inline-flex items-center gap-2" href="/recits/">
            <img
              src="/icons/recits_clear.webp"
              alt=""
              class="menu-icon h-4 w-4 object-contain shrink-0 dark:hidden"
              loading="lazy"
            />
            <img
              src="/icons/recits_dark.webp"
              alt=""
              class="menu-icon hidden h-4 w-4 object-contain shrink-0 dark:block"
              loading="lazy"
            />
            R√©cits
          </a>
        </li>
        <li>
          <a class="text-slate-700 hover:text-black dark:text-slate-200 dark:hover:text-white inline-flex items-center gap-2" href="/ressources/">
            <img src="/icons/ressources_clear.webp" alt="" class="menu-icon h-4 w-4 object-contain shrink-0 dark:invert dark:brightness-90" loading="lazy" />
            Ressources
          </a>
        </li>
        <li>
          <a class="text-slate-700 hover:text-black dark:text-slate-200 dark:hover:text-white inline-flex items-center gap-2" href="/a-propos/">
            <img src="/icons/a_propos_clear.webp" alt="" class="menu-icon h-4 w-4 object-contain shrink-0 dark:invert dark:brightness-90" loading="lazy" />
            √Ä propos
          </a>
        </li>
        <li>
          <a class="text-slate-700 hover:text-black dark:text-slate-200 dark:hover:text-white inline-flex items-center gap-2" href="/contact/">
            <img
              src="/icons/mail_clear.webp"
              alt=""
              class="menu-icon h-4 w-4 object-contain shrink-0 dark:hidden"
              loading="lazy"
            />
            <img
              src="/icons/mail_dark.webp"
              alt=""
              class="menu-icon hidden h-4 w-4 object-contain shrink-0 dark:block"
              loading="lazy"
            />
            Contact
          </a>
        </li>
      </ul>
      <button
        id="theme-toggle"
        class="theme-toggle ml-2 inline-flex items-center gap-2 rounded-full border border-slate-200 bg-white text-sm font-semibold text-slate-800 shadow-sm transition hover:border-slate-300 hover:shadow order-1 md:order-2 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-100 dark:hover:border-slate-400"
        type="button"
        aria-label="Choisir le th√®me : clair, auto, sombre"
      >
        <div class="toggle-track relative h-8 w-16 rounded-full bg-gradient-to-r from-amber-100 to-amber-200 transition-colors duration-200 dark:from-slate-800 dark:to-slate-900">
          <div class="toggle-thumb absolute left-1 top-1 flex h-6 w-6 translate-x-4 items-center justify-center rounded-full bg-white text-base text-amber-500 shadow transition-transform duration-200 dark:bg-slate-700 dark:text-amber-100">
            <span class="toggle-icon leading-none" aria-hidden="true"></span>
          </div>
        </div>
      </button>
    </div>
  </nav>

  <aside
    class="mobile-drawer fixed inset-y-0 right-0 z-40 w-64 translate-x-full transform bg-white border-l border-slate-200 shadow-lg opacity-0 pointer-events-none transition-all duration-200 ease-out md:hidden dark:bg-slate-900/90 dark:border-slate-700/70"
    aria-hidden="true"
    data-mobile-menu
  >
    <div class="p-4 flex items-center justify-between border-b border-slate-200 rounded-t-3xl bg-white dark:border-slate-700/70 dark:bg-slate-900/80">
      <p class="text-lg font-semibold text-slate-800 dark:text-slate-100">Menu</p>
      <button
        class="inline-flex items-center justify-center rounded-full border border-slate-200 px-3 py-1 text-sm font-semibold text-slate-800 hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:hover:bg-slate-800"
        type="button"
        aria-label="Fermer le menu"
        data-menu-close
      >
        ‚úï
      </button>
    </div>
    <ul class="flex flex-col text-slate-700 dark:text-slate-200">
      <li>
        <a class="flex items-center gap-2 border border-slate-200 bg-white px-4 py-3 text-slate-800 transition hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:hover:bg-slate-800" href="/entites/">
          <img src="/icons/entites_clear.webp" alt="" class="menu-icon h-4 w-4 object-contain shrink-0 dark:invert dark:brightness-90" loading="lazy" />
          Entit√©s
        </a>
      </li>
      <li>
        <a class="flex items-center gap-2 border border-slate-200 bg-white px-4 py-3 text-slate-800 transition hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:hover:bg-slate-800" href="/recits/">
          <img
            src="/icons/recits_clear.webp"
            alt=""
            class="menu-icon h-4 w-4 object-contain shrink-0 dark:hidden"
            loading="lazy"
          />
          <img
            src="/icons/recits_dark.webp"
            alt=""
            class="menu-icon hidden h-4 w-4 object-contain shrink-0 dark:block"
            loading="lazy"
          />
          R√©cits
        </a>
      </li>
      <li>
        <a class="flex items-center gap-2 border border-slate-200 bg-white px-4 py-3 text-slate-800 transition hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:hover:bg-slate-800" href="/ressources/">
          <img src="/icons/ressources_clear.webp" alt="" class="menu-icon h-4 w-4 object-contain shrink-0 dark:invert dark:brightness-90" loading="lazy" />
          Ressources
        </a>
      </li>
      <li>
        <a class="flex items-center gap-2 border border-slate-200 bg-white px-4 py-3 text-slate-800 transition hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:hover:bg-slate-800" href="/a-propos/">
          <img src="/icons/a_propos_clear.webp" alt="" class="menu-icon h-4 w-4 object-contain shrink-0 dark:invert dark:brightness-90" loading="lazy" />
          √Ä propos
        </a>
      </li>
      <li>
        <a class="flex items-center gap-2 border border-slate-200 bg-white px-4 py-3 text-slate-800 transition hover:bg-slate-50 dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100 dark:hover:bg-slate-800" href="/contact/">
          <img
            src="/icons/mail_clear.webp"
            alt=""
            class="menu-icon h-4 w-4 object-contain shrink-0 dark:hidden"
            loading="lazy"
          />
          <img
            src="/icons/mail_dark.webp"
            alt=""
            class="menu-icon hidden h-4 w-4 object-contain shrink-0 dark:block"
            loading="lazy"
          />
          Contact
        </a>
      </li>
    </ul>
  </aside>
</header>

<script>
  const THEME_KEY = "mythos-theme";
  const root = document.documentElement;
  const btn = document.getElementById("theme-toggle");
  const iconSpan = btn?.querySelector(".toggle-icon");
  const thumb = btn?.querySelector(".toggle-thumb");
  const mql = window.matchMedia ? window.matchMedia("(prefers-color-scheme: dark)") : null;

  const applyTheme = (theme) => {
    const isDark = theme === "dark";
    const resetClasses = (el) => {
      el.classList.remove("theme-dark", "dark");
    };
    resetClasses(root);
    resetClasses(document.body);
    if (isDark) {
      root.classList.add("theme-dark", "dark");
      document.body.classList.add("theme-dark", "dark");
    }
    root.setAttribute("data-theme", isDark ? "dark" : "light");
    document.body.setAttribute("data-theme", isDark ? "dark" : "light");
  };

  const normalizeMode = (value) => {
    const v = (value || "").toLowerCase().trim();
    return v === "dark" || v === "light" || v === "auto" ? v : "auto";
  };

  const getSystemTheme = () => (mql?.matches ? "dark" : "light");
  const getEffectiveTheme = (mode) => (mode === "auto" ? getSystemTheme() : mode);

  const setThumbPosition = (mode) => {
    if (!thumb) return;
    const positions = {
      light: "translate-x-0",
      auto: "translate-x-4",
      dark: "translate-x-8",
    };
    thumb.classList.remove(...Object.values(positions));
    thumb.classList.add(positions[mode] ?? positions.auto);
  };

  const updateA11y = (mode) => {
    if (!btn) return;
    const label =
      mode === "auto"
        ? "Th√®me : auto (suit le th√®me de l‚Äôappareil)"
        : mode === "dark"
          ? "Th√®me : sombre"
          : "Th√®me : clair";
    btn.setAttribute("aria-label", label);
  };

  const applyMode = (mode) => {
    const effectiveTheme = getEffectiveTheme(mode);
    root.setAttribute("data-theme-mode", mode);
    document.body.setAttribute("data-theme-mode", mode);
    setThumbPosition(mode);
    updateA11y(mode);
    if (iconSpan) iconSpan.textContent = mode === "auto" ? "üåó" : effectiveTheme === "dark" ? "üåô" : "‚òÄÔ∏è";
    applyTheme(effectiveTheme);
    console.debug("[theme] apply", { mode, effectiveTheme });
  };

  let mode = normalizeMode(localStorage.getItem(THEME_KEY));
  applyMode(mode);

  btn?.addEventListener("click", () => {
    const next = mode === "light" ? "auto" : mode === "auto" ? "dark" : "light";
    mode = next;
    localStorage.setItem(THEME_KEY, next);
    applyMode(next);
  });

  mql?.addEventListener?.("change", (event) => {
    if (mode !== "auto") return;
    applyMode(mode);
  });

  const mobileMenu = document.querySelector("[data-mobile-menu]");
  const openBtn = document.querySelector("[data-menu-toggle]");
  const closeBtn = document.querySelector("[data-menu-close]");
  const openClasses = ["translate-x-0", "opacity-100", "pointer-events-auto"];
  const closedClasses = ["translate-x-full", "opacity-0", "pointer-events-none"];

  const toggleMenu = (open) => {
    if (!mobileMenu) return;
    if (open) {
      mobileMenu.classList.add(...openClasses);
      mobileMenu.classList.remove(...closedClasses);
      mobileMenu.setAttribute("aria-hidden", "false");
    } else {
      mobileMenu.setAttribute("aria-hidden", "true");
      mobileMenu.classList.add(...closedClasses);
      mobileMenu.classList.remove(...openClasses);
    }
  };

  openBtn?.addEventListener("click", () => toggleMenu(true));
  closeBtn?.addEventListener("click", () => toggleMenu(false));
</script>
